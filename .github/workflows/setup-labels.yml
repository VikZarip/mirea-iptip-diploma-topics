name: Setup Repository Labels

on:
  workflow_dispatch:  # –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é

permissions:
  issues: write

jobs:
  create-labels:
    runs-on: ubuntu-latest
    steps:
      - name: Create labels
        uses: actions/github-script@v7
        with:
          script: |
            const labels = [
              {
                name: 'reservation',
                description: '–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—é —Ç–µ–º—ã',
                color: '0E8A16'
              },
              {
                name: 'topic-proposal',
                description: '–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ç–µ–º—ã',
                color: '1D76DB'
              },
              {
                name: 'pending-review',
                description: '–û–∂–∏–¥–∞–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è –∫—É—Ä–∞—Ç–æ—Ä–æ–º',
                color: 'FBCA04'
              },
              {
                name: 'approved',
                description: '–û–¥–æ–±—Ä–µ–Ω–æ',
                color: '0E8A16'
              },
              {
                name: 'rejected',
                description: '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ',
                color: 'D93F0B'
              },
              {
                name: 'needs-clarification',
                description: '–¢—Ä–µ–±—É—é—Ç—Å—è —É—Ç–æ—á–Ω–µ–Ω–∏—è',
                color: 'FEF2C0'
              }
            ];

            for (const label of labels) {
              try {
                await github.rest.issues.createLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  name: label.name,
                  description: label.description,
                  color: label.color
                });
                console.log(`‚úÖ –°–æ–∑–¥–∞–Ω –ª–µ–π–±–ª: ${label.name}`);
              } catch (error) {
                if (error.status === 422) {
                  // –õ–µ–π–±–ª —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
                  await github.rest.issues.updateLabel({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    name: label.name,
                    description: label.description,
                    color: label.color
                  });
                  console.log(`üîÑ –û–±–Ω–æ–≤–ª—ë–Ω –ª–µ–π–±–ª: ${label.name}`);
                } else {
                  console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ª–µ–π–±–ª–∞ ${label.name}:`, error.message);
                }
              }
            }
            
            console.log('\nüéâ –í—Å–µ –ª–µ–π–±–ª—ã —Å–æ–∑–¥–∞–Ω—ã/–æ–±–Ω–æ–≤–ª–µ–Ω—ã!');
