# Работа с Jupyter Notebooks

> **Для кого:** Студенты, которые раньше не работали с Jupyter или хотят научиться использовать его эффективно для дипломного проекта.

## 1. Что такое Jupyter Notebook и зачем он нужен

### 1.1 Простыми словами

**Jupyter Notebook** — это интерактивная среда для программирования, где код, результаты выполнения, графики и текст объединены в одном документе.

**Представьте тетрадь (notebook), где вы:**
- Пишете код в ячейках
- Сразу видите результат выполнения
- Добавляете пояснения текстом
- Вставляете графики и таблицы
- Сохраняете всё это в одном файле

**Файл notebook:** `.ipynb` (например, `data_analysis.ipynb`)

### 1.2 Чем отличается от обычных скриптов `.py`

| Jupyter Notebook | Python скрипт `.py` |
|------------------|---------------------|
| Интерактивный — выполняете код по частям | Весь скрипт запускается целиком |
| Видите результат сразу после каждой ячейки | Результат в конце выполнения |
| Можно добавлять текст, формулы, картинки | Только код и комментарии |
| Отлично для исследований и экспериментов | Лучше для готовых программ |
| Графики отображаются прямо в документе | Графики в отдельных окнах |

**Аналогия:**
- Jupyter Notebook = черновик, где вы пробуете разные идеи
- Python скрипт = финальная версия программы

### 1.3 Когда использовать Jupyter в дипломе

**✅ Используйте Jupyter для:**

1. **Исследовательского анализа данных (EDA)**
   - Посмотреть на данные: размер, типы, статистики
   - Найти пропуски, выбросы, аномалии
   - Визуализировать распределения

2. **Экспериментов с моделями**
   - Попробовать разные алгоритмы
   - Сравнить гиперпараметры
   - Посмотреть на результаты

3. **Визуализации результатов**
   - Создать графики для диплома
   - Интерактивные диаграммы
   - Таблицы с метриками

4. **Прототипирования**
   - Быстро проверить идею
   - Написать proof-of-concept

**❌ НЕ используйте Jupyter для:**

1. **Production кода** — код, который идёт в реальное приложение
2. **Модулей для импорта** — функции, которые используются в разных местах
3. **Длинных пайплайнов** — лучше вынести в скрипты
4. **Автоматизации** — CI/CD, автотесты

## 2. Установка и запуск

### 2.1 Установка

**Через pip:**
```bash
pip install notebook
```

**Через Anaconda (если используете):**
```bash
conda install notebook
```

### 2.2 Запуск

```bash
# Перейти в папку проекта
cd /path/to/project

# Запустить Jupyter
jupyter notebook
```

Откроется браузер с интерфейсом, где можно создавать и открывать `.ipynb` файлы.

## 3. Ключевые концепции

### 3.1 Типы ячеек

Jupyter работает с **ячейками** — блоками, которые можно выполнять по отдельности:

**1. Code (ячейка с кодом)**
```python
# Пишете код
x = 10
y = 20
print(x + y)

# Запускаете ячейку → видите результат сразу
```
Результат: `30`

**2. Markdown (ячейка с текстом)**
```markdown
# Заголовок
Обычный текст с **пояснениями**

- Можно делать списки
- Вставлять формулы: $E = mc^2$
```

Используется для **документирования**: объяснить что делаете, зачем, какие выводы.

### 3.2 Интерактивное выполнение

**Ключевая особенность:** Ячейки можно выполнять в любом порядке. Это удобно для экспериментов, но может создать путаницу.

**Пример:**
```python
# Ячейка 1: определяем переменную
data = [1, 2, 3, 4, 5]

# Ячейка 2: считаем сумму
total = sum(data)
print(total)  # 15

# Ячейка 3: изменяем данные
data.append(100)

# Если вернуться и запустить Ячейку 2 снова:
# total будет 115 (так как data изменилась)
```

**Правило:** Перед сохранением и коммитом всегда **перезапускайте notebook сверху вниз** (`Kernel → Restart & Run All`), чтобы убедиться, что всё работает последовательно.

### 3.3 Почему это удобно для диплома

**Сценарий 1: Исследование данных**
```python
# Загрузили данные
df = pd.read_csv('data.csv')

# Посмотрели первые строки
df.head()  # Запустили → увидели результат

# Увидели пропуски → сразу проверили
df.isnull().sum()  # Запустили → увидели статистику

# Визуализировали
df['age'].hist()  # Сразу появился график
```

Всё в одном месте: код → результат → график → выводы.

**Сценарий 2: Эксперименты с моделями**
```python
# Попробовали RandomForest
model = RandomForestClassifier()
model.fit(X_train, y_train)
print(f"Accuracy: {model.score(X_test, y_test)}")  # 0.82

# Не понравилось → попробовали XGBoost (в новой ячейке)
model = XGBClassifier()
model.fit(X_train, y_train)
print(f"Accuracy: {model.score(X_test, y_test)}")  # 0.89 — лучше!
```

Не нужно каждый раз перезапускать весь скрипт — экспериментируйте быстро.

## 4. Организация notebooks в проекте

### 4.1 Структура папки notebooks

**Нумеруйте по порядку выполнения:**
```
notebooks/
├── 01_data_exploration.ipynb      # Первичный анализ данных
├── 02_data_cleaning.ipynb         # Очистка данных
├── 03_feature_engineering.ipynb   # Создание признаков
├── 04_baseline_model.ipynb        # Простая модель
├── 05_model_comparison.ipynb      # Сравнение моделей
├── 06_hyperparameter_tuning.ipynb # Подбор параметров
└── 07_final_results.ipynb         # Финальные результаты
```

**Зачем нумеровать:**
- Понятна последовательность работы
- Легко ориентироваться
- Можно показать научруку: "Смотрите, всё по порядку"

### 4.2 Шаблон структуры notebook

**Каждый notebook должен иметь:**

```markdown
# Название notebook (например: Исследовательский анализ данных)

**Автор:** Ваше имя  
**Дата:** 2025-10-23

## 1. Цель
Что мы хотим сделать / узнать в этом notebook.

Например: "Исследовать датасет, найти пропуски, выбросы, визуализировать распределения."

## 2. Импорты
[Ячейка с импортами]

## 3. Загрузка данных
[Ячейка с загрузкой]

## 4. Анализ
[Ячейки с анализом]

## 5. Выводы
- Что узнали
- Какие проблемы нашли
- Что делать дальше
```

### 4.3 Пример: notebook для EDA

```python
# ============================================
# Ячейка 1: Заголовок (Markdown)
# ============================================
```
```markdown
# Исследовательский анализ данных (EDA)

**Цель:** Понять структуру данных, найти проблемы, визуализировать распределения.
```

```python
# ============================================
# Ячейка 2: Импорты
# ============================================
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# Настройки визуализации
%matplotlib inline
sns.set_style('whitegrid')
plt.rcParams['figure.figsize'] = (10, 6)
```

```python
# ============================================
# Ячейка 3: Загрузка данных
# ============================================
df = pd.read_csv('../data/raw/dataset.csv')
print(f"Загружено {len(df)} записей")
```

```python
# ============================================
# Ячейка 4: Первичный осмотр
# ============================================
# Первые строки
display(df.head())

# Информация о колонках
df.info()

# Статистики
df.describe()
```

```python
# ============================================
# Ячейка 5: Пропуски
# ============================================
missing = df.isnull().sum()
missing = missing[missing > 0].sort_values(ascending=False)

if len(missing) > 0:
    print("Колонки с пропусками:")
    print(missing)
    
    # Визуализация
    plt.figure(figsize=(10, 6))
    missing.plot(kind='bar')
    plt.title('Количество пропусков по колонкам')
    plt.ylabel('Количество')
    plt.show()
else:
    print("✓ Пропусков нет!")
```

```python
# ============================================
# Ячейка 6: Выводы (Markdown)
# ============================================
```
```markdown
## Выводы

1. **Размер данных:** 10,000 записей, 15 признаков
2. **Пропуски:** Найдены в колонках `age` (120 записей) и `income` (45 записей)
3. **Типы данных:** 10 числовых, 5 категориальных
4. **Следующие шаги:**
   - Заполнить пропуски в `age` медианой
   - Удалить записи с пропусками в `income` (их мало)
   - Проверить выбросы в числовых признаках
```

## 5. Полезные возможности

### 5.1 Команды для работы с файлами

Можно запускать команды терминала прямо из notebook:

```python
# Посмотреть файлы
!ls data/

# Установить библиотеку
!pip install seaborn

# Скачать данные
!wget https://example.com/data.csv
```

### 5.2 Автоперезагрузка модулей

Если вы изменили код в папке `src/`, Jupyter по умолчанию не видит изменений. Исправить это:

```python
# В начале notebook
%load_ext autoreload
%autoreload 2

# Теперь изменения в src/ подхватываются автоматически
```

Это полезно, когда вы переносите код из notebook в модули и хотите сразу его тестировать.

### 5.3 Отображение графиков

```python
# Графики будут отображаться прямо в notebook
%matplotlib inline

# Для интерактивных графиков (можно приближать, двигать)
%matplotlib notebook
```

## 6. Интеграция с модулями `src/`

Когда вы выносите код из notebook в модули `src/`, вы можете их импортировать:

**Структура проекта:**
```
project/
├── notebooks/
│   └── 01_analysis.ipynb
└── src/
    └── data/
        └── preprocessing.py
```

**В notebook:**
```python
# Добавить путь к src
import sys
sys.path.append('../')

# Импортировать свой модуль
from src.data.preprocessing import DataPreprocessor

# Использовать
preprocessor = DataPreprocessor()
df = preprocessor.clean(df)
```

**Совет:** Добавьте в начало notebook автоперезагрузку (из раздела 5.2), чтобы не перезапускать каждый раз при изменениях в `src/`.

## 7. Визуализация в Jupyter

### 7.1 Matplotlib

```python
import matplotlib.pyplot as plt

# Линейный график
plt.figure(figsize=(10, 6))
plt.plot([1, 2, 3, 4], [1, 4, 9, 16])
plt.title('Квадраты чисел')
plt.xlabel('x')
plt.ylabel('x²')
plt.grid(True)
plt.show()
```

### 7.2 Seaborn

```python
import seaborn as sns

# Распределение
sns.histplot(df['age'], bins=30, kde=True)
plt.title('Распределение возраста')
plt.show()

# Корреляции
sns.heatmap(df.corr(), annot=True, cmap='coolwarm')
plt.title('Корреляции признаков')
plt.show()
```

### 7.3 Pandas plotting

```python
# Прямо из DataFrame
df['age'].hist(bins=30)
plt.title('Гистограмма возраста')
plt.show()

# Boxplot
df.boxplot(column='income', by='category')
plt.show()
```

### 7.4 Интерактивные графики (Plotly)

```python
import plotly.express as px

# Интерактивный scatter plot
fig = px.scatter(df, x='age', y='income', color='category',
                 title='Возраст vs Доход')
fig.show()
```

## 8. Переход от notebook к production

### 8.1 Когда переносить код в `.py`

**Признаки, что код готов к переносу:**
- ✅ Работает стабильно
- ✅ Используется многократно
- ✅ Нужен в других частях проекта
- ✅ Может быть оформлен как функция/класс

### 8.2 Как переносить

**Было в notebook:**
```python
# Ячейка в notebook
df = pd.read_csv('../data/raw/data.csv')
df = df.dropna()
df = df.drop_duplicates()
df['new_feature'] = df['a'] / df['b']
```

**Стало в `src/data/preprocessing.py`:**
```python
import pandas as pd

class DataPreprocessor:
    def load_and_clean(self, filepath):
        df = pd.read_csv(filepath)
        df = self.clean(df)
        df = self.engineer_features(df)
        return df
    
    def clean(self, df):
        df = df.dropna()
        df = df.drop_duplicates()
        return df
    
    def engineer_features(self, df):
        df['new_feature'] = df['a'] / (df['b'] + 1e-8)
        return df
```

**Теперь в notebook:**
```python
from src.data.preprocessing import DataPreprocessor

preprocessor = DataPreprocessor()
df = preprocessor.load_and_clean('../data/raw/data.csv')
```

**Преимущества:**
- Код переиспользуется
- Легко тестировать
- Notebook остаётся чистым и читаемым

## 9. Советы и лучшие практики

### 9.1 Общие советы

**✅ Делайте:**
1. **Добавляйте заголовки и пояснения** — через месяц забудете, что делали
2. **Нумеруйте notebooks** — понятна последовательность
3. **Очищайте вывод перед коммитом** — не засоряйте Git
4. **Перезапускайте kernel периодически** — избегайте скрытых зависимостей
5. **Выносите функции в `src/`** — не дублируйте код

**❌ Не делайте:**
1. **Не пишите весь проект в одном notebook** — станет нечитаемым
2. **Не коммитьте результаты с большими данными** — Git не для этого
3. **Не полагайтесь на порядок выполнения ячеек** — всегда тестируйте сверху вниз
4. **Не храните секреты в notebook** — используйте `.env`

### 9.2 Очистка outputs перед коммитом

**Зачем:** Результаты выполнения могут занимать много места в Git.

**Вручную:**
- Меню: `Cell → All Output → Clear`

**Автоматически (git hook):**
```bash
# .git/hooks/pre-commit
#!/bin/bash
jupyter nbconvert --clear-output --inplace notebooks/*.ipynb
```

### 9.3 Конвертация notebook в другие форматы

**В Python скрипт:**
```bash
jupyter nbconvert --to script notebook.ipynb
# Создаст notebook.py
```

**В HTML (для отчёта):**
```bash
jupyter nbconvert --to html notebook.ipynb
```

**В PDF:**
```bash
jupyter nbconvert --to pdf notebook.ipynb
```

## 10. Дополнительные возможности

### 10.1 JupyterLab

**JupyterLab** — современная версия Jupyter с улучшенным интерфейсом.

**Установка и запуск:**
```bash
pip install jupyterlab
jupyter lab
```

**Что даёт:**
- Несколько вкладок одновременно
- Встроенный терминал
- Удобный drag & drop файлов

Попробуйте, если классический Jupyter кажется неудобным.

## 11. Чек-лист для работы с notebooks

### Перед началом работы:
- [ ] Notebooks находятся в папке `notebooks/`
- [ ] Notebooks пронумерованы и названы понятно
- [ ] Установлен Jupyter: `pip install notebook`
- [ ] Настроена автоперезагрузка модулей

### В процессе работы:
- [ ] Каждый notebook имеет заголовок и описание цели
- [ ] Код разбит на логические ячейки
- [ ] Добавлены пояснения в Markdown ячейках
- [ ] Графики имеют заголовки и подписи осей
- [ ] Промежуточные выводы записаны

### Перед коммитом:
- [ ] Notebook запущен сверху вниз (Restart & Run All)
- [ ] Все ячейки выполнились без ошибок
- [ ] Очищены outputs (если нужно)
- [ ] Переиспользуемый код вынесен в `src/`
- [ ] Нет хардкоженных путей

### Для защиты диплома:
- [ ] Notebooks чистые и читаемые
- [ ] Результаты воспроизводимы
- [ ] Можно экспортировать в HTML/PDF для показа
- [ ] Ключевые графики сохранены в `reports/figures/`

---

## 12. Дополнительные ресурсы

Если нужна дополнительная информация:

- **Официальная документация:** [jupyter.org/documentation](https://jupyter.org/documentation)
- **Туториалы на русском:** Поиск "Jupyter Notebook туториал" на Хабре или YouTube

---

**Главное:** Jupyter Notebook — инструмент для экспериментов и исследований. Не бойтесь пробовать и ошибаться — это именно то, для чего он создан. Начните с простых примеров, постепенно усложняйте, и он станет вашим главным помощником в работе над дипломом.
