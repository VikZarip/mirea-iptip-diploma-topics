# Миграция архитектуры BI-платформы Apache Superset 5 на асинхронный стек с использованием Litestar

**Статус:** Зарезервирована

## Краткое описание (обязательно)

Данная работа посвящена миграции серверной части аналитического веб-приложения на современный высокопроизводительный стек: Litestar для асинхронного API, вместо синхронного Flask и зависящих от него библиотек (Flask-AppBuilder, Flask-Babel, Flask-Cors и др.). Проект направлен на устранение архитектурных ограничений, повышение пропускной способности системы и снижение требований к аппаратным ресурсам при сохранении полной обратной совместимости с существующим API. 
[Миграция Apache Superset на Litestar.docx](https://github.com/user-attachments/files/23123400/Apache.Superset.Litestar.docx)

## Ожидаемый результат (обязательно)

- Полностью функциональный бэкенд приложения, мигрированный на Litestar с сохранением всех существующих функций
- Модульная архитектура с чёткими границами между бизнес-логикой, уровнем контроллеров и доступом к данным, позволяющая безопасную замену компонентов
- Документированный процесс миграции с описанием архитектурных решений, паттернов и стратегий тестирования
- Набор бенчмарков, демонстрирующих улучшение производительности в реальных сценариях использования
- API остается идентичным существующему, что исключает необходимость изменений во фронтенде и встраиваемых библиотеках.

**Отчётные материалы:**

- Выпускная квалификационная работа (ВКР) с полным описанием архитектурных решений, процесса миграции и результатов тестирования
- Техническая документация по новой архитектуре бэкенда и руководство по развёртыванию
- Презентация с визуализацией метрик производительности и архитектурных диаграмм
- Репозиторий с исходным кодом, конфигурацией для запуска в Docker и автоматизированными тестами

## Возможные функции/компоненты (обязательно)

**1. Асинхронный API на Litestar:**

- Перенос REST API с Flask на Litestar с сохранением сигнатур
- Реализация асинхронных обработчиков для неблокирующих IO-операций
- Интеграция с асинхронным SQLAlchemy для параллельной обработки запросов к БД
- Настройка Gunicorn с асинхронными Uvicorn воркерами для увеличения пропускной способности
- Оптимизация сериализации данных с использованием msgspec вместо marshmallow

**2. Модульная архитектура:**

- Разделение на слои: контроллеры (API), команды (Command, уже внедрён в продукт), доступ к данным (Data Access Object, уже внедрён в продукт)
- Внедрение зависимостей (Dependency Injection) для упрощения тестирования
- Чёткие интерфейсы между слоями для возможности независимой замены компонентов

**3. Система тестирования и метрик:**

- Unit-тесты для критичных компонентов обработки данных
- Integration-тесты для проверки совместимости API
- Benchmark suite для измерения задержек, пропускной способности и потребления ресурсов

## Технологические ожидания

**Предполагаемый стек технологий:**

Библиотеки:

Litestar 2.18.0 - современный асинхронный ASGI-фреймворк
msgspec 19.0 - валидация данных и сериализация
SQLAlchemy 2.0.44 - асинхронный ORM для работы с метаданными

Развертывание:

Uvicorn - ASGI-сервер для запуска Litestar
Uvloop – Производительная реализация цикла событий
Gunicorn + Uvicorn workers - для production развертывания с параллельной обработкой
Docker & Docker Compose - контейнеризация и изоляция окружения
PostgreSQL / MySQL - для хранения метаданных приложения

Тестирования:

Pytest - фреймворк для unit и integration тестов
pytest-benchmark - измерение производительности отдельных функций
wrk - HTTP бенчмарки для замера пропускной способности и задержки

Инструменты разработки:

Black, isort, pylint - линтеры для поддержания качества кода
mypy - статическая проверка типов
pre-commit hooks - автоматизация проверок перед коммитом

## Метрики успеха

**Количественные показатели:**

1. Производительность API:

- Увеличение пропускной способности (запросов в секунду) в 2-3 раза за счёт асинхронной обработки
- Снижение время отклика на 30-50% для IO-bound операций
- Увеличение количества одновременных подключений в 2-4 раза
- Снижение загрузки CPU на 20-40% при той же нагрузке благодаря эффективной обработке IO

2. Масштабируемость:

- Способность обрабатывать на 30-50% больше параллельных запросов при тех же ресурсах
- Линейное масштабирование производительности при увеличении количества worker-процессов
- Снижение времени отклика под пиковой нагрузкой на 40-60%

**Качественные показатели:**

1. Архитектурное качество:

- Разделение ответственности между слоями (контроллеры, сервисы, репозитории)
- Независимость модулей - возможность замены компонентов без каскадных изменений
- Отсутствие циклических зависимостей между модулями
- Покрытие кода тестами не менее 70% для критичных компонентов

2. Поддерживаемость:

- Устранение зависимости от устаревших Apache-библиотек с редкими обновлениями
- Использование активно поддерживаемых open-source проектов с высокой производительностью
- Документированные API через Swagger

## Основные use cases (обязательно)

**Use Case 1: Множественные пользователи одновременно запрашивают данные**

> Роль: 10-50 одновременных пользователей
> Предусловия: Сервер работает с конфигурацией 4 ядер ЦП, 8 гб ОЗУ
>
> **Шаги:**
> 
> 1. 20 пользователей одновременно открывают различные дашборды
> 2. Каждый дашборд выполняет 5-10 запросов к API для загрузки виджетов и фильтров
> 3. Система обрабатывает ~60-100 параллельных HTTP запросов
> 4. Часть запросов требует обращения к базе данных (IO-bound операции)
> 5. Система формирует ответы и отдаёт данные клиентам
> 
> **Ожидаемый результат:**
> 
> 1. Старая система (Flask sync): worker-процессы блокируются на IO, пропускная способность ~50 req/sec
> 2. Новая система (Litestar async): асинхронная обработка позволяет эффективно переключаться между запросами, пропускная способность ~150-200 req/sec
> 3. Все пользователи получают данные с приемлемой задержкой, система не перегружается

## Научная новизна и актуальность

**Актуальность темы:**

Проблема технического долга и необходимость модернизации устаревших систем стоит остро перед многими организациями. По данным исследований, технический долг может составлять до 40% IT-бюджета компаний, создавая существенное финансовое и операционное бремя. Legacy-системы становятся барьером для внедрения новых технологий, увеличивают расходы на поддержку и создают риски безопасности.

В области аналитических веб-приложений ситуация усугубляется ростом объёмов данных и требованиями к скорости обработки. Flask, будучи синхронным фреймворком, создаёт узкие места при обработке большого количества параллельных запросов с IO-операциями.

Современный подход к решению этой проблемы включает использование высокопроизводительных инструментов и асинхронных Python-фреймворков (Litestar, FastAPI, Blacksheep, Starlette и др.), однако практический опыт миграции реальных проектов на эти технологии остаётся недостаточно освещённым.

**Гипотезы исследования:**

1. Переход с синхронного Flask на асинхронный Litestar с использованием асинхронных workers повысит пропускную способность API в 2-3 раза при обработке IO-bound запросов (обращения к БД, внешние API)
2. Модульная архитектура с чёткими границами между слоями позволит сократить time-to-market для новых функций на 30-40% за счёт упрощения разработки, тестирования и повторного использования компонентов
3. Устранение зависимостей от устаревших Apache-библиотек и переход на активно развивающиеся open-source проекты снизит технический долг и упростит дальнейшую поддержку системы.

**Научная новизна:**

1. Практическая методология миграции: Разработка комплексного подхода к миграции backend-систем с legacy-стека на современные технологии с минимальными рисками и простоями. Включает стратегии поэтапной замены компонентов, паттерны сохранения обратной совместимости и методы валидации корректности миграции.
2. Сравнительный анализ производительности: Детальное количественное сравнение производительности Flask vs Litestar на реальных аналитических задачах с измерением не только скорости выполнения, но и потребления ресурсов, масштабируемости и стабильности под нагрузкой.
3. Архитектурные паттерны для асинхронных систем: Разработка и документирование best practices для построения модульной асинхронной архитектуры бэкенда с учётом специфики Python asyncio, включая управление connection pools, обработку ошибок и оптимизацию параллелизма.
4. Метрики оценки успешности миграции: Формализация набора метрик (технических, архитектурных, бизнесовых) для объективной оценки результатов модернизации legacy-систем.

**Исследовательская ценность:**

Работа вносит вклад в понимание практических аспектов модернизации backend-систем и может служить руководством для инженеров, сталкивающихся с аналогичными задачами. Полученные результаты будут полезны для:

- Разработчиков, планирующих миграцию на современный Python-стек
- Архитекторов, проектирующих высокопроизводительные аналитические системы
- Технических лидеров, принимающих решения об инвестициях в модернизацию legacy-кода

## Методы, модели и данные

- Стратегические и тактические паттерны (DDD) для проверки независимости контекстов бизнес-логики при переносе
- Strangler Fig pattern
- Паттерн Фасад (Facade)
- Метрики качества кода и архитектуры (будут определены в ходе исследовательской работы)
- Инструменты нагрузочного тестирования (будут определены в ходе исследовательской работы)
- Методы тестирования асинхронных систем (будут определены в ходе исследовательской работы)


## Практическая польза (обязательно)

1. Разработчикам и архитекторам аналитических систем:

- Получат практическое руководство по миграции на современный высокопроизводительный стек
- Смогут применить архитектурные паттерны и best practices для построения масштабируемых систем
- Изучат реальные примеры решения типичных проблем при асинхронной разработке

2. Командам с legacy-кодом:

- Получат методологию постепенной и безопасной модернизации backend-систем
- Научатся оценивать технический долг и приоритизировать области для рефакторинга
- Смогут обосновать инвестиции в модернизацию через измеримые метрики

3. Организациям с высоконагруженными системами:

- Смогут снизить инфраструктурные затраты за счёт более эффективного использования ресурсов
- Повысят качество пользовательского опыта через сокращение времени отклика
- Увеличат конкурентоспособность благодаря способности быстрее выводить новые фичи на рынок

### Этапы проекта (план студента) — обязательно

1. Миграция инфраструктурного слоя (ноябрь-декабрь)

- Переход на асинхронный SQLAlchemy 2.0
- Настройка AsyncSession и async database drivers
- Внедрение Dependency Injection
- Миграция базовых DAOs и Commands

2. Миграция REST API и бизнес-логики (январь-февраль)

- Перевод Flask-AppBuilder на Litestar Controllers
- Замена Marshmallow на Pydantic DTOs
- Завершение миграции Commands

3. Миграция специфичных компонентов (февраль-март)

- Замена Celery на Dramatiq/ARQ
- Миграция background tasks и SQL Lab
- Миграция вспомогательных компонентов на асинхронный подход

4. Тестирование, оптимизация и внедрение (апрель-май)

- Комплексное тестирование (unit, integration, load testing)
- Benchmarking и оптимизация производительности
- Подготовка production deployment
- Документация и защита диплома

### Источники данных

- Датасеты для нагрузочного тестирования (либо внутренние датасеты заказчика, либо предустановленные датасеты Apache Superset https://github.com/apache/superset)
- Существующая база сценариев тестирования, либо открытая база типовых бизнес-сценариев
- Генератор фейковых данных для нагрузочного тестирования

---

## Как зарезервировать эту тему

Следуйте инструкции в главном [README.md](../../README.md#-как-зарезервировать-тему):
1. Получите код доступа у куратора
2. Создайте Issue с шаблоном "Резервация темы"
3. Укажите slug этой темы (имя файла без `.md`)
4. GitHub Actions автоматически обновит статус

---

## Закреплённые студенты

_Этот раздел заполняется автоматически при резервации темы через GitHub Issues._

<!-- Формат записи: **ФИО** (Группа) — дата — научный руководитель -->
- **Николаевский Кирилл Максимович** (ЭФБО-04-22) — 2025-10-24 — Зарипова В.М.
